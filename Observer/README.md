# Observer

## 动机（Motivation）
+ 在软件构建过程中，我们需要为某些对象建立一种“通知依赖关系” ——一个对象（目标对象）的状态发生改变，所有的依赖对
象（观察者对象）都将得到通知。如果这样的依赖关系过于紧密，将使软件不能很好地抵御变化。
+ 使用面向对象技术，可以将这种依赖关系弱化，并形成一种稳定的依赖关系。从而实现软件体系结构的松耦合。

## 模式定义
定义对象间的一种一对多（变化）的依赖关系，以便当一个对象(Subject)的状态发生改变时，所有依赖于它的对象都得到通知并自动更新。
——《 设计模式》 GoF

## 主要解决：
Observer 模式要解决的问题为： 建立一个一（ Subject）对多（ Observer） 的依赖关系， 并且做到当“一” 变化的时候， 依赖这个“一”的多也能够同步改变。Observer 模式也称为发布－订阅（ publish-subscribe），目标就是通知的发布者，观察者则是通知的订阅者（接受通知）。 最常见的一个例子就是： 对同一组数据进行统计分析时候， 我们希望能够提供多种形式的表示（例如以表格进行统计显示、 柱状图统计显示、 百分比统计显示等）。这些表示都依赖于同一组数据， 我们当然需要当数据改变的时候， 所有的统计的显示都能够同时改变。Observer 模式就是解决了这一个问题。Observer模式提供给关联对象一种同步通信的手段，使某个对象与依赖它的其他对象之间保持状态同步。

## 何时使用：
+ 侦听事件驱动程序设计中的外部事件
+ 侦听/监视某个对象的状态变化
+ 发布者/订阅者(publisher/subscriber)模型中，当一个外部事件（新的产品，消息的出现等等）被触发时，通知邮件列表中的订阅者


## 如何使用：
被观察者通过注册的回调函数进行发布通知

## 代码结构：
Subject（被观察者）

 被观察的对象。当需要被观察的状态发生变化时，需要通知队列中所有观察者对象。Subject需要维持（添加，删除，通知）一个观察者对象的队列列表。

ConcreteSubject

被观察者的具体实现。包含一些基本的属性状态及其他操作。

Observer（观察者）

接口或抽象类。当Subject的状态发生变化时，Observer对象将通过一个callback函数得到通知。

ConcreteObserver

观察者的具体实现。得到通知后将完成一些具体的业务逻辑处理。

## 扩展方式
继承观察者基类，实现具体业务。

## 要点总结
+ 使用面向对象的抽象，Observer模式使得我们可以独立地改变目标与观察者，从而使二者之间的依赖关系达致松耦合。
+ 目标发送通知时，无需指定观察者，通知（可以携带通知信息作为参数）会自动传播。
+ 观察者自己决定是否需要订阅通知，目标对象对此一无所知。
+ Observer模式是基于事件的UI框架中非常常用的设计模式，也是MVC模式的一个重要组成部分。

## 优缺点
观察者模式（Observer Pattern）的优缺点如下：

+ 优点
1、解耦：观察者模式能够将被观察者（Subject）和观察者（Observer）解耦，使得被观察者的改变不会直接影响到观察者，两者之间的依赖关系降低。

2、扩展性：新的观察者可以在不修改被观察者代码的情况下被添加到系统中，提高了系统的可扩展性。

3、灵活性：观察者模式允许观察者对象对被观察者的状态变化做出反应，这使得系统可以灵活地响应状态变化。

4、广播通信：观察者模式支持广播通信，即被观察者可以同时通知多个观察者对象。

5、可定制响应：不同的观察者可以对相同的事件做出不同的响应，增加了系统的灵活性。

6、松散关联：观察者和被观察者之间的松散关联关系使得在系统中添加新的观察者或被观察者变得容易，而不需要修改现有的代码。

+ 缺点
1、循环依赖：在实现观察者模式时，如果不当心，可能会导致循环依赖的问题，特别是当观察者和被观察者相互持有对方的引用时。

2、内存泄漏：如果观察者和被观察者之间的引用关系没有正确管理，可能会导致内存泄漏。例如，如果被观察者持有观察者的强引用，而观察者又没有正确地从被观察者列表中移除自己，可能会导致无法释放内存。

3、性能开销：当有大量的观察者时，通知所有观察者可能会带来性能开销，尤其是在被观察者状态变化频繁的情况下。

4、顺序依赖：在某些情况下，观察者的更新顺序可能会影响系统的正确性，这需要在设计时仔细考虑。

5、过度使用：在一些简单的场景中，过度使用观察者模式可能会增加不必要的复杂性。

6、错误处理：在观察者模式中，如果一个观察者在更新时发生错误，可能会影响到其他观察者的更新，这需要在设计时考虑错误处理机制。

7、通知的一致性：确保所有观察者都能接收到通知，并且按照预期的顺序接收通知，可能是一个挑战。

## 观察者模式在实际开发中有哪些常见的应用场景？
观察者模式在实际开发中有许多应用场景，它主要用于实现事件处理和通知机制。以下是一些典型的应用实例：

+ 事件处理系统：在图形用户界面（GUI）编程中，观察者模式用于处理用户的行为，如点击、滚动、按键等事件。当用户执行这些操作时，系统会通知所有注册的观察者（如按钮、文本框等）。

+ 游戏开发：在游戏开发中，观察者模式可以用来实现游戏状态的监听和响应。例如，当玩家的分数发生变化时，游戏可以通知得分牌、排行榜等观察者对象。

+ 模型-视图-控制器（MVC）框架：在MVC架构中，观察者模式用于实现视图（View）和控制器（Controller）对模型（Model）的依赖关系。当模型数据发生变化时，自动更新视图。

+ 软件架构中的发布-订阅系统：在大型软件系统中，观察者模式可以实现跨组件的通信。组件可以注册为观察者，订阅感兴趣的事件，当事件发生时，系统会通知所有订阅者。

+ 数据绑定：在现代编程框架中，观察者模式用于实现数据绑定。当数据模型发生变化时，自动更新界面元素，如输入框、列表等。

+ 通知系统：在需要实现通知和消息传递的系统中，观察者模式可以用来通知用户或系统组件关于状态变化的信息，如电子邮件客户端中的新邮件通知。

+ 股票价格监控：在金融应用中，观察者模式可以用来监控股票价格的变化。当股票价格达到特定阈值时，系统可以通知投资者或执行自动交易。

+ 缓存系统：在缓存系统中，观察者模式可以用来监听数据的变更，当数据更新时，缓存可以同步更新或失效。

+ 实时协作编辑：在多人协作编辑文档的应用程序中，观察者模式可以用来同步不同用户对文档的更改。

+ 硬件驱动程序：在操作系统中，观察者模式可以用来监听硬件状态的变化，如电池电量、网络连接状态等，并在状态变化时通知应用程序。

+ 观察者模式的优点在于它提供了一种松耦合的方式来实现组件之间的通信，使得系统更加灵活和可维护。然而，它也可能导致系统复杂度增加，特别是在有大量观察者和事件时，管理和维护这些关系可能会变得复杂。

## 在实现观察者模式时，如何确保被观察者和观察者之间的通信是线程安全的？
[text](https://blog.csdn.net/weixin_36750623/article/details/84797133) 使用智能指针实现线程安全，参考muduo中chnnel中提升connection生命周期。